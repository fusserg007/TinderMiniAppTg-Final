# Развертывание на Timeweb Cloud

Это руководство поможет вам развернуть ваше приложение на платформе Timeweb Cloud с использованием Docker Compose.

## 1. Подготовка

### 1.1. Загрузка проекта на GitHub

Убедитесь, что ваш проект загружен на GitHub, включая следующие файлы:

- `docker-compose.timeweb.yml`
- `nginx/nginx.timeweb.conf`
- `.env` (убедитесь, что он содержит все необходимые переменные для продакшена)
- Все исходные коды (`backend`, `tg-web-app`)

**Важно:** Не забудьте добавить `.env` в `.gitignore`, чтобы случайно не опубликовать ваши секреты. На Timeweb Cloud вы будете устанавливать переменные окружения через их панель управления.

### 1.2. Настройка переменных окружения в `.env`

Перед развертыванием убедитесь, что ваш `.env` файл настроен для продакшена. Вам нужно будет установить эти переменные в панели Timeweb Cloud.

Примерное содержимое `.env`:

```
# MongoDB Atlas
MONGODB_URI=mongodb+srv://<user>:<password>@cluster.mongodb.net/your_db?retryWrites=true&w=majority

# MinIO (S3-совместимое хранилище)
MINIO_ROOT_USER=your_minio_user
MINIO_ROOT_PASSWORD=your_minio_password
AWS_ACCESS_KEY_ID=your_minio_user
AWS_SECRET_ACCESS_KEY=your_minio_password
AWS_BUCKET=your_bucket_name

# ImgProxy
IMGPROXY_KEY=your_imgproxy_key
IMGPROXY_SALT=your_imgproxy_salt

# Telegram Bot
BOT_TOKEN=your_telegram_bot_token
VITE_BOT_USERNAME=your_telegram_bot_username

# Backend & Frontend URLs
VITE_BACKEND_URL=https://your-app-name.twc1.net/api

# Production
NODE_ENV=production
DOMAIN=your-app-name.twc1.net
```

## 2. Развертывание в Timeweb Cloud

1.  **Войдите в панель управления Timeweb Cloud.**
2.  Перейдите в раздел **«Облачные приложения»**.
3.  Нажмите **«Создать приложение»**.
4.  **Подключите ваш GitHub репозиторий.**
5.  **Выберите репозиторий** с вашим проектом.
6.  На шаге **«Настройка приложения»** выберите:
    *   **Тип:** Docker
    *   **Подтип:** Docker Compose
    *   **Путь к docker-compose.yml:** `docker-compose.timeweb.yml`
7.  **Настройте переменные окружения.**
    *   На этом этапе вам нужно будет добавить все переменные из вашего `.env` файла. Нажмите **«Добавить переменную»** для каждой.
8.  **Настройте домен.**
    *   Timeweb Cloud предоставит вам технический домен вида `your-app-name.twc1.net`. Вы также можете привязать свой собственный домен.
9.  **Настройте проксирование.**
    *   Сервис автоматически определит, что ваш `nginx` слушает порт `8080` и настроит проксирование на него.
10. **Запустите развертывание.**
    *   Нажмите **«Создать приложение»**. Timeweb Cloud начнет сборку и развертывание вашего приложения.

## 3. Проверка

После завершения развертывания:

1.  **Проверьте логи.** В панели управления вы можете посмотреть логи каждого сервиса, чтобы убедиться, что все запустилось без ошибок.
2.  **Откройте ваше приложение** по предоставленному домену.
3.  **Протестируйте все функции:**
    *   Регистрация/авторизация через Telegram.
    *   Загрузка изображений.
    *   Работа API.

## 4. Устранение неполадок

*   **Ошибки сборки:** Проверьте логи сборки в панели Timeweb. Чаще всего проблемы связаны с неправильными путями в `Dockerfile` или `docker-compose.timeweb.yml`.
*   **502 Bad Gateway:** Это означает, что Nginx не может связаться с одним из ваших сервисов (backend, frontend, imgproxy). Проверьте логи Nginx и соответствующих сервисов, чтобы понять, почему они не отвечают.
*   **Переменные окружения:** Убедитесь, что все переменные окружения правильно установлены в панели Timeweb Cloud.
